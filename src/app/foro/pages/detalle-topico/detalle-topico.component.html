<div class="detalle-topico-container">
  <!-- Header del tópico -->
  <div class="detalle-header">
    <div class="header-top">
      <button class="btn-volver" (click)="volverAlForo()">
        <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd"
            d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
            clip-rule="evenodd" />
        </svg>
        Volver al foro
      </button>
      <div class="editar-acciones" *ngIf="topico.usuario === usuarioLogin">
        <button class="btn-editar" (click)="editarTopico()">
          <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M12.707 2.293a1 1 0 00-1.414 0l-9 9a1 1 0 00-.293.707V16a2 2 0 002 2h4.414a1 1 0 00.707-.293l9-9a1 1 0 000-1.414l-4-4zM11.586 15H7v-4.586l8-8L19.586 7l-8 8z"
              clip-rule="evenodd" />
        </svg>
        Editar Tópico
      </button>

      <button class="btn-eliminar" (click)="mostrarConfirmacionEliminacion()">
        <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd"
            d="M6 2a1 1 0 00-1 1v1H4a1 1 0 100 2h1v10a1 1 0 001 1h10a1 1 0 001-1V6h1a1 1 0 100-2h-1V3a1 1 0 00-1-1H6zm0 2h8v10H6V4z"
            clip-rule="evenodd" />
        </svg>
        Eliminar Tópico
      </button>


      <h1 class="titulo-principal">{{ topico?.titulo }}</h1>
      <div class="meta-info">
        <div class="meta-item">
          <svg class="meta-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z"
              clip-rule="evenodd" />
          </svg>
          <span>{{ topico?.fechaCreacion | date:'medium' }}</span>
        </div>
        <div class="meta-item">
          <svg class="meta-icon" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M10.394 2.08a1 1 0 00-.788 0l-7 3a1 1 0 000 1.84L5.25 8.051a.999.999 0 01.356-.257l4-1.714a1 1 0 11.788 1.838L7.667 9.088l1.94.831a1 1 0 00.787 0l7-3a1 1 0 000-1.838l-7-3z" />
          </svg>
          <span>{{ topico?.nombreCurso }}</span>
        </div>
      </div>
    </div>

    <!-- Mensaje principal del tópico -->
    <div class="mensaje-principal">
      <div class="autor-avatar">
        <div class="avatar">
          {{ obtenerInicial(topico?.usuario) }}
        </div>
        <div class="autor-info">
          <div class="autor-nombre">{{ topico?.usuario }}</div>
          <div class="autor-rol">Estudiante</div>
        </div>
      </div>
      <div class="mensaje-contenido">
        <p>{{ topico?.mensaje }}</p>
      </div>
    </div>

    <!-- Sección de respuestas -->
    <div class="respuestas-section">
      <div class="respuestas-header">
        <h3>
          <svg class="section-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z"
              clip-rule="evenodd" />
          </svg>
          Respuestas ({{ respuestas.length }})
        </h3>
      </div>
      <div *ngIf="respuestas.length === 0" class="sin-respuestas">
        <svg class="icono-vacio" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd"
            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-3a1 1 0 00-.867.5 1 1 0 11-1.731-1A3 3 0 0113 8a3.001 3.001 0 01-2 2.83V11a1 1 0 11-2 0v-1a1 1 0 011-1 1 1 0 100-2zm0 8a1 1 0 100-2 1 1 0 000 2z"
            clip-rule="evenodd" />
        </svg>
        <p>Aún no hay respuestas.</p>
        <p class="subtitulo">¡Sé el primero en responder!</p>
      </div>

      <div class="respuestas-lista">
        <div class="respuesta-card" *ngFor="let r of respuestas; let i = index"
          [style.animation-delay]="(i * 0.1) + 's'">
          <div class="respuesta-avatar">
            <div class="avatar-small">
              {{ obtenerInicial(r.autor) }}
            </div>
          </div>
          <div class="respuesta-contenido">
            <div class="respuesta-header">
              <div class="respuesta-autor">{{ r.autor }}</div>
              <div class="autor-nombre">{{ topico?.autor }}</div>
              <div class="respuesta-fecha">{{ r.fechaCreacion | date:'short' }}</div>
              <div class="respuesta-acciones">
             <div class="respuesta-acciones" *ngIf="r.autor === usuarioLogin">
  <button class="btn-editar-respuesta" (click)="activarEdicionRespuesta(r)">
    <svg class="btn-icon-edit" viewBox="0 0 20 20" fill="currentColor">
      <path fill-rule="evenodd" d="M12.707 2.293a1 1 0 00-1.414 0l-9 9a1 1 0 00-.293.707V16a2 2 0 002 2h4.414a1 1 0 00.707-.293l9-9a1 1 0 000-1.414l-4-4zM11.586 15H7v-4.586l8-8L19.586 7l-8 8z" clip-rule="evenodd" />
    </svg>
    Editar
  </button>
</div>

<!--   <button (click)="eliminarRespuesta(r)">Eliminar</button> -->
              </div>
            </div>
            <div class="respuesta-mensaje">
              <p>{{ r.mensaje }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Formulario para nueva respuesta -->
    <div class="formulario-respuesta">
      <div class="formulario-header">
        <h4>
          <svg class="section-icon" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd"
              d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
              clip-rule="evenodd" />
          </svg>
          Escribir una respuesta
        </h4>
      </div>

      <div class="formulario-contenido">
        <div class="usuario-actual">
          <div class="avatar-small">
            {{ obtenerInicial(nombreUsuario) }}
          </div>
          <span class="usuario-nombre">{{ nombreUsuario }}</span>

        </div>

        <div class="campo-grupo">
          <textarea [(ngModel)]="nuevaRespuesta"
            placeholder="Comparte tu conocimiento, experiencia o ayuda con esta pregunta..." rows="4"
            class="campo-textarea"></textarea>
          <div class="campo-ayuda">Sé respetuoso y constructivo en tu respuesta</div>
        </div>
        <div class="acciones-respuesta">
          <div class="contador-caracteres">
            <span [ngClass]="{
    'limite-cerca': nuevaRespuesta.length > 250 && nuevaRespuesta.length <= 250,
    'limite-excedido': nuevaRespuesta.length > 250
  }">
              {{ nuevaRespuesta.length || 0 }}/250
            </span>
          </div>
          <button class="btn-responder" (click)="responderTopico()" [disabled]="!nuevaRespuesta.trim()">
            <svg class="btn-icon" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z" />
            </svg>
            Publicar Respuesta
          </button>
        </div>
      </div>
    </div>
  </div>


  <!-- Modal de edición de topico -->
  <div class="modal" *ngIf="modoEdicion">
    <div class="modal-contenido">
      <h3>Editar Tópico</h3>
      <div class="modal-acciones">
        <button class="btn-guardar" (click)="confirmarActualizacion()">Guardar</button>
        <div class="modal" (click)="cancelarEdicion()">
          <div class="modal-contenido" (click)="$event.stopPropagation()">
            <h3>Editar Tópico</h3>
            <label>
              Título:
              <input [(ngModel)]="topicoEditado.titulo" />
            </label>
            <label>
              Curso:
              <select [(ngModel)]="topicoEditado.nombreCurso" class="campo-select">
                <option value="" disabled>Selecciona un curso</option>
                <option *ngFor="let curso of cursos" [value]="curso">{{ curso }}</option>
              </select>
            </label>

            <label>
              Mensaje:
              <textarea [(ngModel)]="topicoEditado.mensaje" rows="4"></textarea>
            </label>
            <div class="modal-acciones">
              <button class="btn-guardar" (click)="confirmarActualizacion()">Guardar</button>
              <button class="btn-cancelar" (click)="cancelarEdicion()">Cancelar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal para editar una respuesta -->
<div class="modal" *ngIf="modoEdicionRespuesta">
  <div class="modal" (click)="cancelarEdicionRespuesta()">
  <div class="modal-contenido" (click)="$event.stopPropagation()">
    <h3>Editar Respuesta</h3>

    <label>
      Mensaje:
      <textarea [(ngModel)]="respuestaEditada.mensaje" rows="4" placeholder="Edita tu respuesta..." class="campo-textarea"></textarea>
    </label>

    <div class="modal-acciones">
      <button class="btn-guardar" (click)="confirmarEdicionRespuesta()">Guardar</button>
    </div>
  </div>
  </div>
</div>
<!-- Modal de confirmación de eliminación -->
<div class="modal" *ngIf="mostrarModalEliminacion">
  <div class="modal" (click)="cancelarEliminacion()">
  <div class="modal-contenido" (click)="$event.stopPropagation()">
    <h3>¿Eliminar Tópico?</h3>
    <p>¿Estás seguro de que deseas eliminar este tópico? Esta acción no se puede deshacer.</p>
    <div class="modal-acciones">
      <button class="btn-cancelar" (click)="cancelarEliminacion()">Cancelar</button>
      <button class="btn-guardar" (click)="confirmarEliminacion()">Sí, eliminar</button>
    </div>
  </div>
</div>

